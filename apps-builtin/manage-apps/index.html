{{#> admin }}
{{#*inline "content-block"}}
  <div id="message"></div>
  <ul class="apps">
  {{#with apps}}
    {{#each apps}}
      {{#unless background }}
      <li>
        <button class="update" data-app={{appid}}>Update</button> <button class="remove" data-app="{{appid}}">Remove</button>
        <h2>{{name}}</h2>
        <p>{{description}}</p>
      </li>
      {{/unless}}
    {{/each}}
  {{/with}}
  </ul>
  <script>

var addClickHandler = function(selector, fn){
  var sel = document.querySelectorAll(selector);
  for(var i=0; i<sel.length; i++){
    sel[i].addEventListener('click', function(e){
      e.preventDefault();
      fn(e);
      return false;
    });
  }
}

addClickHandler('a.update', function(e){
  var app = e.target.getAttribute('data-app');
  var xhr = new XMLHttpRequest();
  xhr.open("POST", "update/" + app);
  xhr.send();
});

addClickHandler('a.remove', function(e){
  if(confirm("Are you sure you want to remove this app?")){
    var app = e.target.getAttribute('data-app');
    var xhr = new XMLHttpRequest();
    xhr.open("DELETE", "remove/" + app);
    xhr.send();
  }
});

  </script>
{{/inline}}
{{/ admin }}
